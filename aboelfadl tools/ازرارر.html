<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صانع الروابط المحفوظة</title>
    <style>
        :root {
            --primary-color: #1a1a1a;
            --secondary-color: #2c2c2c;
            --accent-color: #ffd700; /* Gold */
            --text-color: #ffffff;
            --input-bg-color: #333333;
            --danger-color: #dc3545; /* Red for clear button */
        }

        body {
            font-family: 'Tajawal', sans-serif;
            background-color: var(--primary-color);
            color: var(--text-color);
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }

        .mobile-container {
            width: 100%;
            max-width: 480px;
            background-color: var(--secondary-color);
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            overflow: hidden;
            display: flex;
            flex-direction: column;
            height: 90vh;
        }

        .header {
            background-color: var(--accent-color);
            color: var(--primary-color);
            padding: 20px;
            text-align: center;
            font-size: 1.5em;
            font-weight: bold;
        }

        .main-content {
            padding: 20px;
            flex-grow: 1;
            overflow-y: auto;
        }

        .input-section, .search-section {
            margin-bottom: 20px;
        }

        textarea, input[type="search"] {
            width: 100%;
            padding: 15px;
            border: 2px solid var(--accent-color);
            border-radius: 10px;
            background-color: var(--input-bg-color);
            color: var(--text-color);
            font-size: 1em;
            box-sizing: border-box;
            resize: vertical;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .button-group .clear-btn {
            grid-column: span 2; /* Make clear button full width */
        }

        button {
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-weight: bold;
        }

        .paste-btn {
            background-color: var(--accent-color);
            color: var(--primary-color);
        }

        .generate-btn {
            background-color: #4CAF50;
            color: white;
        }
        
        .clear-btn {
            background-color: var(--danger-color);
            color: white;
        }

        .links-container {
            margin-top: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .link-btn {
            background-color: var(--input-bg-color);
            color: var(--text-color);
            text-decoration: none;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            border: 1px solid var(--accent-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: background-color 0.3s ease, transform 0.2s ease;
        }

        .link-btn:hover {
            background-color: var(--accent-color);
            color: var(--primary-color);
            transform: translateY(-2px);
        }

        .footer {
            padding: 20px;
            text-align: center;
        }

        .download-btn {
            background-color: #007bff;
            color: white;
            font-weight: bold;
            width: 100%;
        }

        /* Scrollbar styles */
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: var(--secondary-color); }
        ::-webkit-scrollbar-thumb { background: var(--accent-color); border-radius: 10px; }
    </style>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
</head>
<body onload="loadLinks()">

    <div class="mobile-container">
        <div class="header">
            صانع الروابط المحفوظة
        </div>

        <div class="main-content">
            <div class="input-section">
                <label for="links-input" style="display:block; margin-bottom:10px;">أضف روابط جديدة:</label>
                <textarea id="links-input" rows="5" placeholder="https://www.google.com"></textarea>
                <div class="button-group">
                    <button class="paste-btn" onclick="pasteFromClipboard()">لصق</button>
                    <button class="generate-btn" onclick="addLinks()">إضافة الأزرار</button>
                    <button class="clear-btn" onclick="clearAllLinks()">مسح الكل</button>
                </div>
            </div>

            <div class="search-section">
                <label for="search-input" style="display:block; margin-bottom:10px;">ابحث في الروابط المحفوظة:</label>
                <input type="search" id="search-input" onkeyup="searchLinks()" placeholder="اكتب للبحث...">
            </div>

            <div id="links-container" class="links-container">
                </div>
        </div>

        <div class="footer">
            <button class="download-btn" onclick="downloadHTML()">تحميل كود HTML</button>
        </div>
    </div>

    <script>
        let allLinks = [];

        function loadLinks() {
            const savedLinks = localStorage.getItem('savedLinks');
            if (savedLinks) {
                allLinks = JSON.parse(savedLinks);
                renderLinks();
            }
        }

        function renderLinks() {
            const linksContainer = document.getElementById('links-container');
            linksContainer.innerHTML = '';
            allLinks.forEach(link => {
                const button = document.createElement('a');
                button.href = link;
                button.textContent = getLinkName(link);
                button.className = 'link-btn';
                button.target = '_blank';
                linksContainer.appendChild(button);
            });
             searchLinks();
        }

        function saveLinksToStorage() {
            localStorage.setItem('savedLinks', JSON.stringify(allLinks));
        }

        function addLinks() {
            const linksInput = document.getElementById('links-input');
            const newLinksText = linksInput.value.trim();
            if (!newLinksText) {
                alert('الرجاء إدخال رابط واحد على الأقل في المربع.');
                return;
            }
            const newLinksArray = newLinksText.split('\n').filter(link => link.trim() !== '');
            newLinksArray.forEach(link => {
                if (!allLinks.includes(link)) {
                    allLinks.push(link);
                }
            });
            saveLinksToStorage();
            renderLinks();
            linksInput.value = '';
        }

        function clearAllLinks() {
            if (confirm('هل أنت متأكد أنك تريد مسح جميع الروابط المحفوظة؟')) {
                allLinks = [];
                saveLinksToStorage();
                renderLinks();
            }
        }

        async function pasteFromClipboard() {
            try {
                const text = await navigator.clipboard.readText();
                document.getElementById('links-input').value += text;
            } catch (err) {
                alert('فشل في قراءة الحافظة. الرجاء اللصق يدويًا.');
            }
        }

        function getLinkName(url) {
            try {
                const urlObject = new URL(url);
                let hostname = urlObject.hostname.replace('www.', '');
                let name = hostname.substring(0, hostname.lastIndexOf('.'));
                return name.charAt(0).toUpperCase() + name.slice(1);
            } catch (error) {
                return url.length > 30 ? url.substring(0, 27) + '...' : url;
            }
        }

        function searchLinks() {
            const filter = document.getElementById('search-input').value.toUpperCase();
            const linksContainer = document.getElementById('links-container');
            const buttons = linksContainer.getElementsByTagName('a');
            for (let i = 0; i < buttons.length; i++) {
                const txtValue = buttons[i].textContent || buttons[i].innerText;
                if (txtValue.toUpperCase().indexOf(filter) > -1) {
                    buttons[i].style.display = "";
                } else {
                    buttons[i].style.display = "none";
                }
            }
        }

        // --- التعديل الجديد هنا ---
        function downloadHTML() {
            const currentLinksHTML = document.getElementById('links-container').innerHTML;
            if (!currentLinksHTML.trim()) {
                alert('لا توجد روابط لإنشاء ملف HTML. أضف بعض الروابط أولاً.');
                return;
            }

            // طلب اسم الملف من المستخدم
            let fileName = prompt("الرجاء إدخال اسم للملف:", "my-links-app");
            if (fileName === null || fileName.trim() === "") { // في حالة إلغاء الأمر أو إدخال اسم فارغ
                console.log("تم إلغاء عملية التحميل.");
                return; // إيقاف الدالة
            }

            const initialLinks = JSON.stringify(allLinks);

            const htmlContent = `
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${fileName}</title>
    <style>
        :root { --primary-color: #1a1a1a; --secondary-color: #2c2c2c; --accent-color: #ffd700; --text-color: #ffffff; --input-bg-color: #333333; --danger-color: #dc3545; }
        body { font-family: 'Tajawal', sans-serif; background-color: var(--primary-color); color: var(--text-color); margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { width: 100%; max-width: 520px; }
        h1 { color: var(--accent-color); text-align: center; }
        .input-section, .search-section { margin-bottom: 20px; padding: 20px; background-color: var(--secondary-color); border-radius: 10px; }
        label { display:block; margin-bottom:10px; font-weight: bold; }
        textarea, input[type="search"] { width: 100%; padding: 15px; border: 2px solid var(--accent-color); border-radius: 10px; background-color: var(--input-bg-color); color: var(--text-color); font-size: 1em; box-sizing: border-box; }
        .button-group { display: flex; gap: 10px; margin-top: 10px; }
        button { flex-grow: 1; padding: 12px; border: none; border-radius: 10px; font-size: 1em; cursor: pointer; font-weight: bold; transition: opacity 0.3s; }
        button:hover { opacity: 0.9; }
        .add-btn { background-color: #4CAF50; color: white; }
        .clear-btn { background-color: var(--danger-color); color: white; }
        .links-container { margin-top: 20px; display: flex; flex-direction: column; gap: 10px; }
        .link-btn { background-color: var(--input-bg-color); color: var(--text-color); text-decoration: none; padding: 15px; border-radius: 10px; text-align: center; border: 1px solid var(--accent-color); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; transition: background-color 0.3s; }
        .link-btn:hover { background-color: var(--accent-color); color: var(--primary-color); }
    </style>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">
</head>
<body onload="loadLinks()">
    <div class="container">
        <h1>روابطي المحفوظة</h1>
        <div class="input-section">
            <label for="links-input">أضف روابط جديدة هنا:</label>
            <textarea id="links-input" rows="4" placeholder="https://example.com"></textarea>
            <div class="button-group">
                <button class="add-btn" onclick="addLinks()">إضافة</button>
                <button class="clear-btn" onclick="clearAllLinks()">مسح الكل</button>
            </div>
        </div>
        <div class="search-section">
            <label for="search-input">ابحث في روابطك:</label>
            <input type="search" id="search-input" onkeyup="searchLinks()" placeholder="اكتب للبحث...">
        </div>
        <div id="links-container" class="links-container"></div>
    </div>
    <script>
        let allLinks = [];
        const storageKey = 'myIndependentLinks';

        function loadLinks() {
            const savedLinks = localStorage.getItem(storageKey);
            const initialLinks = JSON.parse('${initialLinks}');
            if (savedLinks) {
                allLinks = JSON.parse(savedLinks);
            } else if (initialLinks.length > 0) {
                allLinks = initialLinks;
                saveLinksToStorage();
            }
            renderLinks();
        }

        function renderLinks() {
            const linksContainer = document.getElementById('links-container');
            linksContainer.innerHTML = '';
            allLinks.forEach(link => {
                const button = document.createElement('a');
                button.href = link;
                button.textContent = getLinkName(link);
                button.className = 'link-btn';
                button.target = '_blank';
                linksContainer.appendChild(button);
            });
            searchLinks();
        }

        function saveLinksToStorage() {
            localStorage.setItem(storageKey, JSON.stringify(allLinks));
        }

        function addLinks() {
            const linksInput = document.getElementById('links-input');
            const newLinksText = linksInput.value.trim();
            if (!newLinksText) return;
            const newLinksArray = newLinksText.split('\\n').filter(link => link.trim() !== '');
            newLinksArray.forEach(link => {
                if (!allLinks.includes(link)) allLinks.push(link);
            });
            saveLinksToStorage();
            renderLinks();
            linksInput.value = '';
        }

        function clearAllLinks() {
            if (confirm('هل أنت متأكد؟ سيتم حذف جميع الروابط من هذا الملف.')) {
                allLinks = [];
                saveLinksToStorage();
                renderLinks();
            }
        }

        function getLinkName(url) {
            try {
                let name = new URL(url).hostname.replace('www.', '');
                return name.charAt(0).toUpperCase() + name.slice(1, name.lastIndexOf('.'));
            } catch (e) { return url; }
        }

        function searchLinks() {
            const filter = document.getElementById('search-input').value.toUpperCase();
            const buttons = document.getElementById('links-container').getElementsByTagName('a');
            for (let i = 0; i < buttons.length; i++) {
                buttons[i].style.display = buttons[i].textContent.toUpperCase().includes(filter) ? "" : "none";
            }
        }
    <\/script>
</body>
</html>`;

            const blob = new Blob([htmlContent.trim()], { type: 'text/html' });
            const a = document.createElement('a');
            a.href = URL.createObjectURL(blob);
            // استخدام اسم الملف الذي أدخله المستخدم وإضافة امتداد .html
            a.download = `${fileName}.html`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>
