<!DOCTYPE html><html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ“ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ© - AboElfadl Tools</title>
  <style>
    body {
      background-color: #000;
      color: #fff;
      font-family: 'Cairo', sans-serif;
      margin: 0;
      padding: 0;
    }
    .container {
      max-width: 500px;
      margin: auto;
      padding: 15px;
    }
    h1 {
      text-align: center;
      color: #ffd700;
      margin: 20px 0;
    }
    .tool-card {
      background: #1a1a1a;
      border-radius: 15px;
      padding: 15px;
      margin-bottom: 20px;
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.1);
    }
    .tool-title {
      background: #ffd700;
      color: #000;
      padding: 10px;
      border-radius: 10px;
      font-weight: bold;
      text-align: center;
      margin-bottom: 15px;
    }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: none;
      border-radius: 10px;
      background: #333;
      color: #ffd700;
    }
    button {
      width: 100%;
      padding: 10px;
      border: none;
      border-radius: 10px;
      background: #ffd700;
      color: #000;
      font-weight: bold;
      margin-top: 5px;
      cursor: pointer;
    }
    .result {
      margin-top: 10px;
      background: #222;
      color: #ffd700;
      padding: 10px;
      border-radius: 10px;
      white-space: pre-wrap;
    }
    .tools-bar {
      display: flex;
      gap: 5px;
      margin-top: 5px;
      flex-wrap: wrap;
    }
    .tools-bar button {
      flex: 1;
      font-size: 13px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ğŸ“ Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠØ©</h1>

<div class="tool-card">
  <div class="tool-title">ğŸ“ Ø§Ù„Ù…Ø¹Ø¯Ù„ Ø§Ù„ØªØ±Ø§ÙƒÙ…ÙŠ Ù…Ù† 4 Ø¥Ù„Ù‰ 100</div>
  <input type="number" id="gpa" placeholder="Ø§Ù„Ù…Ø¹Ø¯Ù„ Ù…Ù† 4">
  <button onclick="convertGPA()">ØªØ­ÙˆÙŠÙ„</button>
  <div class="result" id="gpaResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('gpaResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('gpaResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆØ²ÙˆÙ†Ø© -->
<div class="tool-card">
  <div class="tool-title">ğŸ“ˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆØ²ÙˆÙ†Ø©</div>
  <input type="number" id="thanawya" placeholder="Ø§Ù„Ø«Ø§Ù†ÙˆÙŠØ© Ø§Ù„Ø¹Ø§Ù…Ø© %">
  <input type="number" id="qiyas" placeholder="Ù‚ÙŠØ§Ø³ %">
  <input type="number" id="step" placeholder="ØªØ­ØµÙŠÙ„ÙŠ %">
  <button onclick="calcWeighted()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="weightedResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('weightedResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('weightedResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ© -->
<div class="tool-card">
  <div class="tool-title">ğŸ’° Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©</div>
  <input type="number" id="priceBefore" placeholder="Ø§Ù„Ø³Ø¹Ø± Ù‚Ø¨Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©">
  <input type="number" id="vatRate" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© %">
  <button onclick="calcVAT()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="vatResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('vatResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('vatResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ø­Ø³Ø§Ø¨ Ø§Ù„Ø²ÙƒØ§Ø© -->
<div class="tool-card">
  <div class="tool-title">ğŸ•Œ Ø­Ø³Ø§Ø¨ Ø²ÙƒØ§Ø© Ø§Ù„Ù…Ø§Ù„</div>
  <input type="number" id="moneyAmount" placeholder="Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø§Ù„">
  <button onclick="calcZakat()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="zakatResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('zakatResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('zakatResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ù…Ø­ÙˆÙ„ Ø§Ù„Ø·ÙˆÙ„ -->
<div class="tool-card">
  <div class="tool-title">ğŸ“ Ù…Ø­ÙˆÙ„ Ø§Ù„Ø·ÙˆÙ„</div>
  <input type="number" id="lengthInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø©">
  <select id="lengthType">
    <option value="cm2inch">Ø³Ù… Ø¥Ù„Ù‰ Ø¥Ù†Ø´</option>
    <option value="inch2cm">Ø¥Ù†Ø´ Ø¥Ù„Ù‰ Ø³Ù…</option>
    <option value="m2ft">Ù…ØªØ± Ø¥Ù„Ù‰ Ù‚Ø¯Ù…</option>
    <option value="ft2m">Ù‚Ø¯Ù… Ø¥Ù„Ù‰ Ù…ØªØ±</option>
  </select>
  <button onclick="convertLength()">Ø­ÙˆÙ‘Ù„</button>
  <div class="result" id="lengthResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('lengthResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('lengthResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>

<div class="tool-card">
  <div class="tool-title">ğŸ“Š Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù…Ù† Ù…Ø¨Ù„Øº</div>
  <input type="number" id="percentBase" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ">
  <input type="number" id="percentValue" placeholder="Ø§Ù„Ù†Ø³Ø¨Ø© %">
  <button onclick="calcPercent()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="percentResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('percentResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('percentResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ø§Ù„Ø®ØµÙ… -->
<div class="tool-card">
  <div class="tool-title">ğŸ”» Ø§Ù„Ø®ØµÙ…</div>
  <input type="number" id="discountBase" placeholder="Ø§Ù„Ù…Ø¨Ù„Øº Ù‚Ø¨Ù„ Ø§Ù„Ø®ØµÙ…">
  <input type="number" id="discountRate" placeholder="Ù†Ø³Ø¨Ø© Ø§Ù„Ø®ØµÙ… %">
  <button onclick="calcDiscount()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="discountResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('discountResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('discountResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ø§Ù„Ø¬Ø°Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠ -->
<div class="tool-card">
  <div class="tool-title">ğŸ“ Ø§Ù„Ø¬Ø°Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠ</div>
  <input type="number" id="sqrtInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø±Ù‚Ù…">
  <button onclick="calcSqrt()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="sqrtResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('sqrtResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('sqrtResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ -->
<div class="tool-card">
  <div class="tool-title">ğŸ“‰ Ø§Ù„Ù…ØªÙˆØ³Ø· Ø§Ù„Ø­Ø³Ø§Ø¨ÙŠ</div>
  <input type="text" id="averageList" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„">
  <button onclick="calcAverage()">Ø§Ø­Ø³Ø¨</button>
  <div class="result" id="averageResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('averageResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('averageResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

<!-- Ù…Ø­ÙˆÙ„ Ø§Ù„Ø­Ø±Ø§Ø±Ø© -->
<div class="tool-card">
  <div class="tool-title">ğŸŒ¡ï¸ Ù…Ø­ÙˆÙ„ Ø§Ù„Ø­Ø±Ø§Ø±Ø© (Ù…Ø¦ÙˆÙŠ â†” ÙÙ‡Ø±Ù†Ù‡Ø§ÙŠØª)</div>
  <input type="number" id="tempInput" placeholder="Ø£Ø¯Ø®Ù„ Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©">
  <select id="tempType">
    <option value="c2f">Ù…Ø¦ÙˆÙŠ Ø¥Ù„Ù‰ ÙÙ‡Ø±Ù†Ù‡Ø§ÙŠØª</option>
    <option value="f2c">ÙÙ‡Ø±Ù†Ù‡Ø§ÙŠØª Ø¥Ù„Ù‰ Ù…Ø¦ÙˆÙŠ</option>
  </select>
  <button onclick="convertTemp()">Ø­ÙˆÙ‘Ù„</button>
  <div class="result" id="tempResult"></div>
  <div class="tools-bar">
    <button onclick="copyText('tempResult')">ğŸ“‹ Ù†Ø³Ø®</button>
    <button onclick="downloadText('tempResult')">ğŸ’¾ ØªØ­Ù…ÙŠÙ„</button>
  </div>
</div>

  </div>  <script>
    function copyText(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text);
      alert("ğŸ“‹ ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
    }

    function downloadText(id) {
      const text = document.getElementById(id).innerText;
      const blob = new Blob([text], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = id + ".txt";
      link.click();
    }

    function calcPercent() {
      const base = parseFloat(document.getElementById('percentBase').value);
      const rate = parseFloat(document.getElementById('percentValue').value);
      if (isNaN(base) || isNaN(rate)) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©");
      const result = base * (rate / 100);
      document.getElementById('percentResult').innerText = `ğŸ“Š Ø§Ù„Ù‚ÙŠÙ…Ø© = ${result.toFixed(2)} Ù…Ù† ${base}`;
    }

    function calcDiscount() {
      const base = parseFloat(document.getElementById('discountBase').value);
      const rate = parseFloat(document.getElementById('discountRate').value);
      const discount = base * (rate / 100);
      const final = base - discount;
      document.getElementById('discountResult').innerText = `ğŸ’¸ Ø¨Ø¹Ø¯ Ø§Ù„Ø®ØµÙ…: ${final.toFixed(2)} (Ø§Ù„Ø®ØµÙ… = ${discount.toFixed(2)})`;
    }

    function calcSqrt() {
      const n = parseFloat(document.getElementById('sqrtInput').value);
      if (isNaN(n)) return alert("Ø£Ø¯Ø®Ù„ Ø±Ù‚Ù… ØµØ­ÙŠØ­");
      document.getElementById('sqrtResult').innerText = `ğŸ§® Ø§Ù„Ø¬Ø°Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠ: ${Math.sqrt(n).toFixed(4)}`;
    }

    function calcAverage() {
      const list = document.getElementById('averageList').value.split(',').map(Number).filter(n => !isNaN(n));
      if (list.length === 0) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø£Ø±Ù‚Ø§Ù… Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„");
      const avg = list.reduce((a,b)=>a+b,0) / list.length;
      document.getElementById('averageResult').innerText = `ğŸ“‰ Ø§Ù„Ù…ØªÙˆØ³Ø·: ${avg.toFixed(2)}`;
    }

    function convertTemp() {
      const value = parseFloat(document.getElementById('tempInput').value);
      const type = document.getElementById('tempType').value;
      if (isNaN(value)) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ù‚ÙŠÙ…Ø© ØµØ­ÙŠØ­Ø©");
      let result;
      if (type === "c2f") {
        result = (value * 9/5) + 32;
        document.getElementById('tempResult').innerText = `${value}Â°C = ${result.toFixed(2)}Â°F`;
      } else {
        result = (value - 32) * 5/9;
        document.getElementById('tempResult').innerText = `${value}Â°F = ${result.toFixed(2)}Â°C`;
      }
    }
  </script>
<script>
    function copyText(id) {
      const text = document.getElementById(id).innerText;
      navigator.clipboard.writeText(text);
      alert("ğŸ“‹ ØªÙ… Ø§Ù„Ù†Ø³Ø®!");
    }

    function downloadText(id) {
      const text = document.getElementById(id).innerText;
      const blob = new Blob([text], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = id + ".txt";
      link.click();
    }

    function convertGPA() {
      const gpa = parseFloat(document.getElementById('gpa').value);
      if (isNaN(gpa) || gpa < 0 || gpa > 4) return alert("Ø§Ù„Ù…Ø¹Ø¯Ù„ ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† Ø¨ÙŠÙ† 0 Ùˆ 4");
      const converted = (gpa / 4) * 100;
      document.getElementById('gpaResult').innerText = `ğŸ¯ Ø§Ù„Ù†Ø³Ø¨Ø© = ${converted.toFixed(2)}Ùª`;
    }

    function calcWeighted() {
      const t = parseFloat(document.getElementById('thanawya').value);
      const q = parseFloat(document.getElementById('qiyas').value);
      const s = parseFloat(document.getElementById('step').value);
      if ([t, q, s].some(v => isNaN(v))) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ… ÙƒØ§Ù…Ù„Ø©");
      const result = (t * 0.3) + (q * 0.3) + (s * 0.4);
      document.getElementById('weightedResult').innerText = `ğŸ“ˆ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙˆØ²ÙˆÙ†Ø© = ${result.toFixed(2)}Ùª`;
    }

    function calcVAT() {
      const price = parseFloat(document.getElementById('priceBefore').value);
      const rate = parseFloat(document.getElementById('vatRate').value);
      if (isNaN(price) || isNaN(rate)) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ… ØµØ­ÙŠØ­Ø©");
      const tax = price * (rate / 100);
      const total = price + tax;
      document.getElementById('vatResult').innerText = `ğŸ’° Ø§Ù„Ø³Ø¹Ø± Ø´Ø§Ù…Ù„ Ø§Ù„Ø¶Ø±ÙŠØ¨Ø©: ${total.toFixed(2)} (Ø§Ù„Ø¶Ø±ÙŠØ¨Ø© = ${tax.toFixed(2)})`;
    }

    function calcZakat() {
      const amount = parseFloat(document.getElementById('moneyAmount').value);
      if (isNaN(amount)) return alert("Ø£Ø¯Ø®Ù„ Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø§Ù„");
      const zakat = amount * 0.025;
      document.getElementById('zakatResult').innerText = `ğŸ•Œ Ø§Ù„Ø²ÙƒØ§Ø© Ø§Ù„ÙˆØ§Ø¬Ø¨Ø©: ${zakat.toFixed(2)}`;
    }

    function convertLength() {
      const value = parseFloat(document.getElementById('lengthInput').value);
      const type = document.getElementById('lengthType').value;
      if (isNaN(value)) return alert("Ø£Ø¯Ø®Ù„ Ø§Ù„Ù‚ÙŠÙ…Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­");
      let result = 0;
      switch (type) {
        case "cm2inch": result = value / 2.54; break;
        case "inch2cm": result = value * 2.54; break;
        case "m2ft": result = value * 3.28084; break;
        case "ft2m": result = value / 3.28084; break;
      }
      document.getElementById('lengthResult').innerText = `ğŸ“ Ø§Ù„Ù†Ø§ØªØ¬ = ${result.toFixed(2)}`;
    }
  </script>
</body>
</html>




<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Ø¢Ù„Ø© Ø­Ø§Ø³Ø¨Ø© Ø¹Ù„Ù…ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" integrity="sha512-Fo3rlrZj/k7aS7lqT6/wL7Q+G/G2b8oF5l5c5A5r7q8j9w4B1eQ7b2D9R9w8C4x0A2B3v5l6c0A1B0b2e8g==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        /* CSS Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ */
        body {
            font-family: 'Roboto', sans-serif;
            margin: 0;
            padding: 20px;
            background: #f0f0f0;
            color: #000;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            transition: background 0.3s, color 0.3s;
            overflow-y: auto; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„Ø­Ø§Ø¬Ø© */
        }

        body.dark {
            background: #121212;
            color: #fff;
        }

        #calculator {
            max-width: 480px; /* Ø²ÙŠØ§Ø¯Ø© Ø§Ù„Ø¹Ø±Ø¶ Ù„Ø§Ø³ØªÙŠØ¹Ø§Ø¨ 7 Ø£Ø¹Ù…Ø¯Ø© */
            width: 100%;
            margin: 20px auto;
            background: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            transition: background 0.3s, box-shadow 0.3s;
        }

        body.dark #calculator {
            background: #252525;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„Ø¹Ø±Ø¶ */
        #display-container {
            position: relative;
            margin-bottom: 15px;
            background: #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            overflow: hidden; /* Ù„Ù…Ù†Ø¹ ØªØ¬Ø§ÙˆØ² Ø§Ù„Ù†Øµ */
            height: 90px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        body.dark #display-container {
            background: #3a3a3a;
            color: white;
        }

        #history-display {
            font-size: 18px;
            color: #777;
            text-align: right;
            height: 25px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª */
            overflow: hidden;
            white-space: nowrap;
            direction: ltr; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„ÙŠÙ…ÙŠÙ† */
            text-overflow: ellipsis; /* Ù„Ø¥Ø¶Ø§ÙØ© Ù†Ù‚Ø§Ø· ÙÙŠ Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù†Øµ Ø§Ù„Ø·ÙˆÙŠÙ„ */
        }
        body.dark #history-display {
            color: #bbb;
        }

        #display {
            width: 100%;
            background: transparent;
            border: none;
            font-size: 48px;
            text-align: right;
            color: #000;
            outline: none;
            padding: 0;
            box-sizing: border-box;
            direction: ltr; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„ÙŠÙ…ÙŠÙ† */
        }
        body.dark #display {
            color: white;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù„ÙˆÙŠØ© */
        .top-controls {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙØ§Ù Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙÙŠ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
            gap: 8px;
        }

        .top-controls button {
            flex-grow: 1; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ø§Ù„ØªÙˆØ³Ø¹ */
            padding: 10px 15px;
            font-size: 15px;
            border-radius: 8px;
            background-color: #007bff;
            color: white;
            transition: background-color 0.2s, transform 0.1s;
            display: flex; /* Ù„ÙƒÙŠ ØªØªÙˆØ³Ø· Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙˆØ§Ù„Ù†Øµ Ø¥Ù† ÙˆØ¬Ø¯ */
            justify-content: center;
            align-items: center;
        }

        .top-controls button:hover {
            background-color: #0056b3;
            transform: translateY(-1px);
        }

        body.dark .top-controls button {
            background-color: #0056b3;
        }
        body.dark .top-controls button:hover {
            background-color: #003d7a;
        }

        /* Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ… ÙƒØ£ÙŠÙ‚ÙˆÙ†Ø© */
        #toggle-theme {
            font-size: 20px; /* Ø­Ø¬Ù… Ø£ÙƒØ¨Ø± Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© */
            padding: 10px; /* Ù…Ø³Ø§ÙØ© Ø¯Ø§Ø®Ù„ÙŠØ© Ù…ØªØ³Ø§ÙˆÙŠØ© */
            width: 40px; /* Ø¹Ø±Ø¶ Ø«Ø§Ø¨Øª Ù„Ø¬Ø¹Ù„Ù‡ Ù…Ø±Ø¨Ø¹Ù‹Ø§ */
            height: 40px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ø¬Ø¹Ù„Ù‡ Ù…Ø±Ø¨Ø¹Ù‹Ø§ */
            flex-grow: 0; /* Ù„Ø§ ÙŠØªÙ…Ø¯Ø¯ */
            /* ÙŠÙ…ÙƒÙ†Ùƒ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† Ù„Ø²Ø± Ø§Ù„Ø«ÙŠÙ… Ø¨Ø´ÙƒÙ„ Ù…Ù†ÙØµÙ„ Ø¥Ø°Ø§ Ø£Ø±Ø¯Øª */
            background-color: #f0f0f0; /* Ù„ÙˆÙ† Ø®ÙÙŠÙ ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ */
            color: #333; /* Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù†Ù‡Ø§Ø±ÙŠ */
            border: 1px solid #ccc;
        }
        #toggle-theme:hover {
            background-color: #e0e0e0;
        }
        body.dark #toggle-theme {
            background-color: #444; /* Ù„ÙˆÙ† Ø¯Ø§ÙƒÙ† ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
            color: gold; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ù„Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© ÙÙŠ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
            border-color: gold;
        }
        body.dark #toggle-theme:hover {
            background-color: #555;
        }


        /* ØªØ®Ø·ÙŠØ· Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ ÙˆØ§Ù„Ù…ØªÙ‚Ø¯Ù… */
        .buttons-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr); /* 7 Ø£Ø¹Ù…Ø¯Ø© ÙƒÙ…Ø§ ÙÙŠ Ø§Ù„ØµÙˆØ± */
            gap: 8px;
        }

        /* Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ù†ÙØ³Ù‡Ø§ */
        .buttons-grid button {
            padding: 18px 0;
            font-size: 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background-color: #f5f5f5; /* Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„ÙØ§ØªØ­ */
            color: #333;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s, color 0.2s, box-shadow 0.2s, transform 0.1s;
        }

        body.dark .buttons-grid button {
            background-color: #363636; /* Ù„ÙˆÙ† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¯Ø§ÙƒÙ† */
            color: white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
        }

        .buttons-grid button:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        body.dark .buttons-grid button:hover {
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.5);
        }

        /* Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª */
        .buttons-grid button.operator {
            background-color: #007bff; /* Ø£Ø²Ø±Ù‚ */
            color: white;
        }
        body.dark .buttons-grid button.operator {
            background-color: #0056b3;
        }
        .buttons-grid button.operator:hover {
            background-color: #0056b3;
        }
        body.dark .buttons-grid button.operator:hover {
            background-color: #003d7a;
        }

        /* Ø²Ø± Clear (C) */
        .buttons-grid button.clear-button {
            background-color: #ff9800; /* Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ */
            color: white;
        }
        body.dark .buttons-grid button.clear-button {
            background-color: #e68900;
        }
        .buttons-grid button.clear-button:hover {
            background-color: #e68900;
        }
        body.dark .buttons-grid button.clear-button:hover {
            background-color: #cc7a00;
        }

        /* Ø²Ø± Equals (=) */
        .buttons-grid button.equal-button {
            background-color: #4CAF50; /* Ø£Ø®Ø¶Ø± */
            color: white;
        }
        body.dark .buttons-grid button.equal-button {
            background-color: #388e3c;
        }
        .buttons-grid button.equal-button:hover {
            background-color: #388e3c;
        }
        body.dark .buttons-grid button.equal-button:hover {
            background-color: #2e7d32;
        }
        
        /* Ø²Ø± Backspace (â†) */
        .buttons-grid button.backspace-button {
            background-color: #f44336; /* Ø£Ø­Ù…Ø± */
            color: white;
        }
        body.dark .buttons-grid button.backspace-button {
            background-color: #d32f2f;
        }
        .buttons-grid button.backspace-button:hover {
            background-color: #d32f2f;
        }
        body.dark .buttons-grid button.backspace-button:hover {
            background-color: #c62828;
        }

        /* Ø²Ø± Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø© */
        #copy-result {
            margin-top: 15px;
            width: 100%;
            padding: 15px;
            font-size: 18px;
            background-color: #6c757d; /* Ø±Ù…Ø§Ø¯ÙŠ */
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.2s, transform 0.1s;
        }
        #copy-result:hover {
            background-color: #5a6268;
            transform: translateY(-1px);
        }
        body.dark #copy-result {
            background-color: #495057;
        }
        body.dark #copy-result:hover {
            background-color: #343a40;
        }

        /* Ø£Ù‚Ø³Ø§Ù… Ø¥Ø¶Ø§ÙÙŠØ© (Ø§Ù„Ø¹Ù…Ø±ØŒ Ø§Ù„Ø³Ø¬Ù„) */
        #age-calculator, #history-container {
            margin-top: 20px;
            padding: 15px;
            background: #fdfdfd;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: background 0.3s, box-shadow 0.3s;
        }
        body.dark #age-calculator, body.dark #history-container {
            background: #333333;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }

        #age-calculator label, #age-calculator input[type="date"] {
            display: block;
            margin-bottom: 10px;
        }
        #age-calculator input[type="date"] {
            width: calc(100% - 20px);
            padding: 10px;
            font-size: 18px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
            background: #fff;
            color: #000;
        }
        body.dark #age-calculator input[type="date"] {
            background: #444;
            border-color: #555;
            color: white;
        }

        #age-calculator button {
            width: 100%;
            padding: 12px;
            font-size: 18px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        #age-calculator button:hover {
            background-color: #218838;
        }
        body.dark #age-calculator button {
            background-color: #218838;
        }
        body.dark #age-calculator button:hover {
            background-color: #1e7e34;
        }

        #age-result {
            margin-top: 15px;
            padding: 10px;
            background: #e9ecef;
            border-radius: 5px;
            font-size: 16px;
            white-space: pre-line;
            color: #333;
        }
        body.dark #age-result {
            background: #495057;
            color: white;
        }

        #history h4 {
            margin-top: 0;
            color: #555;
        }
        body.dark #history h4 {
            color: #ccc;
        }
        #history ul {
            list-style: none;
            padding: 0;
            max-height: 200px; /* Ø§Ø±ØªÙØ§Ø¹ Ø«Ø§Ø¨Øª Ù„Ù„Ø³Ø¬Ù„ */
            overflow-y: auto; /* Ù„Ù„Ø³Ù…Ø§Ø­ Ø¨Ø§Ù„ØªÙ…Ø±ÙŠØ± Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ø¬Ù„ */
            border: 1px solid #eee;
            border-radius: 5px;
            background: #fdfdfd;
        }
        body.dark #history ul {
            border-color: #555;
            background: #444;
        }
        #history li {
            padding: 8px 12px;
            border-bottom: 1px solid #eee;
            font-size: 15px;
            color: #444;
            direction: ltr; /* Ù„Ø¶Ù…Ø§Ù† Ø¹Ø±Ø¶ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± Ù„Ù„ÙŠÙ…ÙŠÙ† */
            text-align: right;
        }
        body.dark #history li {
            border-color: #555;
            color: #eee;
        }
        #history li:last-child {
            border-bottom: none;
        }

        /* Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ°ÙŠÙŠÙ„ */
        #footer-link {
            margin-top: 25px;
            padding: 12px;
            border: 2px solid #007bff;
            text-align: center;
            border-radius: 10px;
            text-decoration: none;
            display: block;
            color: #007bff;
            font-weight: bold;
            transition: background-color 0.2s, color 0.2s, border-color 0.2s;
        }
        #footer-link:hover {
            background-color: #007bff;
            color: white;
        }
        body.dark #footer-link {
            color: gold; /* Ù„ÙˆÙ† Ø°Ù‡Ø¨ÙŠ Ù„Ù„ÙˆØ¶Ø¹ Ø§Ù„Ù„ÙŠÙ„ÙŠ */
            border-color: gold;
        }
        body.dark #footer-link:hover {
            background-color: gold;
            color: black;
        }

        /* Ø§Ù„Ø³Ø§Ø¹Ø© */
        #clock {
            text-align: center;
            font-size: 20px;
            margin-bottom: 15px;
            font-weight: bold;
            color: #555;
        }
        body.dark #clock {
            color: #ccc;
        }

        /* Ø§Ø³ØªØ¬Ø§Ø¨Ø© Ø§Ù„ØªØµÙ…ÙŠÙ… Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
        @media (max-width: 600px) {
            body {
                padding: 10px;
            }
            #calculator {
                padding: 15px;
                border-radius: 10px;
            }
            #display {
                font-size: 38px;
                height: 70px;
            }
            #history-display {
                font-size: 16px;
                height: 20px;
            }
            .buttons-grid {
                gap: 6px;
            }
            .buttons-grid button {
                padding: 15px 0;
                font-size: 18px;
                border-radius: 6px;
            }
            .top-controls button {
                font-size: 13px;
                padding: 8px 10px;
            }
            /* Adjust size for the theme toggle icon on small screens */
            #toggle-theme {
                font-size: 18px;
                width: 36px;
                height: 36px;
                padding: 0; /* Reset padding for precise sizing with flexbox */
                display: flex;
                justify-content: center;
                align-items: center;
            }
            #copy-result {
                padding: 12px;
                font-size: 16px;
            }
            #age-calculator input[type="date"], #age-calculator button {
                font-size: 16px;
                padding: 10px;
            }
            #age-result, #history li {
                font-size: 14px;
            }
            #clock {
                font-size: 18px;
            }
        }
    </style>
</head>
<body>
    <div id="calculator">
        <div class="top-controls">
            <button id="toggle-theme">
                <i class="fas fa-moon"></i> </button>
            <button id="toggle-history">Ø§Ù„Ø³Ø¬Ù„</button>
            <button id="toggle-age">Ø§Ø­Ø³Ø¨ Ø¹Ù…Ø±Ùƒ</button>
        </div>
        <div id="clock"></div>

        <div id="display-container">
            <div id="history-display"></div>
            <input type="text" id="display" disabled value="0" />
        </div>

        <div class="buttons-grid" id="calculator-buttons">
            <button class="control-button" data-type="toggle-2nd">2nd</button>
            <button class="control-button" data-type="toggle-raddeg">Rad</button>
            <button onclick="appendFunction('Math.sqrt(')">âˆš</button>
            <button class="clear-button" onclick="clearDisplay()">C</button>
            <button onclick="append('(')">(</button>
            <button onclick="append(')')">)</button>
            <button onclick="append('%')">%</button>
            <button class="operator" onclick="append('/')">Ã·</button>

            <button data-function="sin" onclick="appendFunction('Math.sin(')">sin</button>
            <button data-function="cos" onclick="appendFunction('Math.cos(')">cos</button>
            <button data-function="tan" onclick="appendFunction('Math.tan(')">tan</button>
            <button onclick="append('7')">7</button>
            <button onclick="append('8')">8</button>
            <button onclick="append('9')">9</button>
            <button class="operator" onclick="append('*')">Ã—</button>

            <button data-function="ln" onclick="appendFunction('Math.log(')">ln</button>
            <button data-function="log" onclick="appendFunction('Math.log10(')">log</button>
            <button onclick="applyUnaryOperator('1/', true)">1/x</button>
            <button onclick="append('4')">4</button>
            <button onclick="append('5')">5</button>
            <button onclick="append('6')">6</button>
            <button class="operator" onclick="append('-')">-</button>

            <button data-function="exp" onclick="appendFunction('Math.exp(')">eË£</button>
            <button data-function="x2" onclick="applyUnaryOperator('**2')">xÂ²</button>
            <button data-function="xy" onclick="append('**')">xÊ¸</button>
            <button onclick="append('1')">1</button>
            <button onclick="append('2')">2</button>
            <button onclick="append('3')">3</button>
            <button class="operator" onclick="append('+')">+</button>

            <button data-function="abs" onclick="appendFunction('Math.abs(')">|x|</button>
            <button data-constant="pi" onclick="append('Math.PI')">Ï€</button>
            <button data-constant="e" onclick="append('Math.E')">e</button>
            <button onclick="changeSign()">+/-</button>
            <button onclick="append('0')">0</button>
            <button onclick="append('.')">.</button>
            <button class="equal-button" onclick="calculate()">=</button>

            <button class="backspace-button" onclick="backspace()">â†</button>
        </div>

        <button id="copy-result" onclick="copyResult()">Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©</button>

        <div id="age-calculator" style="display: none;">
            <label for="birthdate">Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯Ùƒ:</label>
            <input type="date" id="birthdate" max="" />
            <button onclick="calculateAgeAndZodiac()">Ø§Ø­Ø³Ø¨ Ø§Ù„Ø¹Ù…Ø± ÙˆØ§Ù„Ø¨Ø±Ø¬</button>
            <div id="age-result" style="margin-top:10px; white-space: pre-line;"></div>
        </div>

        <div id="history-container" style="display: none;">
            <h4>Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</h4>
            <ul id="history"></ul>
            <button onclick="clearHistory()">Ù…Ø³Ø­ Ø§Ù„Ø³Ø¬Ù„</button>
        </div>

        <a id="footer-link" href="https://mahmoud-aboelfadl.my.canva.site/" target="_blank">
            ØªÙ… ØµÙ†Ø¹ Ù‡Ø°Ø§ Ø¨ÙˆØ§Ø³Ø·Ø© Mahmoud Aboelfadl
        </a>
    </div>

    <script>
        // Get DOM Elements
        const display = document.getElementById('display');
        const historyDisplay = document.getElementById('history-display');
        const calculatorButtons = document.getElementById('calculator-buttons');
        const ageCalculatorDiv = document.getElementById('age-calculator');
        const historyContainerDiv = document.getElementById('history-container');
        const birthdateInput = document.getElementById('birthdate');
        const ageResultDiv = document.getElementById('age-result');
        const historyList = document.getElementById('history');
        const toggleThemeButton = document.getElementById('toggle-theme'); // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø²Ø± ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø«ÙŠÙ…

        // State Variables
        let currentExpression = '';
        let history = [];
        let isSecondMode = false; // For 2nd function button
        let isRadians = true; // For Rad/Deg button
        let lastResult = ''; // To store the last calculated result

        // Initialize Max Date for Birthdate Input
        birthdateInput.max = new Date().toISOString().split('T')[0];

        // Define scientific function mappings for 1st and 2nd modes
        const functionMap = {
            'sin': { '1st': 'Math.sin(', '2nd': 'Math.asin(', 'text1': 'sin', 'text2': 'sinâ»Â¹' },
            'cos': { '1st': 'Math.cos(', '2nd': 'Math.acos(', 'text1': 'cos', 'text2': 'cosâ»Â¹' },
            'tan': { '1st': 'Math.tan(', '2nd': 'Math.atan(', 'text1': 'tan', 'text2': 'tanâ»Â¹' },
            'ln': { '1st': 'Math.log(', '2nd': 'Math.log1p(', 'text1': 'ln', 'text2': 'ln(1+x)' }, // natural log
            'log': { '1st': 'Math.log10(', '2nd': 'Math.log2(', 'text1': 'log', 'text2': 'logâ‚‚' }, // base 10 log, base 2 log
            'exp': { '1st': 'Math.exp(', '2nd': 'Math.pow(10,', 'text1': 'eË£', 'text2': '10Ë£' }, // e^x, 10^x
            'x2': { '1st': '**2', '2nd': '**3', 'text1': 'xÂ²', 'text2': 'xÂ³' }, // x^2, x^3
            'xy': { '1st': '**', '2nd': 'root(', 'text1': 'xÊ¸', 'text2': 'Ê¸âˆšx' }, // x^y, y-th root of x (handled differently)
            'abs': { '1st': 'Math.abs(', '2nd': 'Math.cbrt(', 'text1': '|x|', 'text2': 'Â³âˆšx' }, // absolute, cube root
            // 'fact': { '1st': 'factorial(', '2nd': '', 'text1': 'x!', 'text2': '' } // factorial (needs custom function) - added as part of general calculation flow
        };

        // --- Core Calculator Functions ---

        function append(val) {
            if (display.value === '0' && val !== '.' && !isNaN(val)) {
                display.value = val;
                currentExpression = val;
            } else {
                display.value += val;
                currentExpression += val;
            }
            historyDisplay.textContent = currentExpression;
        }

        function appendFunction(func) {
            if (display.value === '0') { // Clear default 0 when starting with a function
                display.value = '';
                currentExpression = '';
            }
            currentExpression += func;
            display.value += func; // Show the function call on display
            historyDisplay.textContent = currentExpression;
        }

        // Handles unary operators like 1/x, x^2, x^3, factorial, etc.
        // This function is now more for applying operators that immediately change the last number.
        function applyUnaryOperator(operatorText, isDivision = false) {
            if (currentExpression === '' || display.value === 'Error' || isNaN(parseFloat(display.value))) {
                // If current expression is empty or not a number, or an error, do nothing or clear
                return;
            }

            let value = parseFloat(display.value);
            let result;

            if (isDivision) {
                result = 1 / value;
            } else if (operatorText === '**2') {
                result = Math.pow(value, 2);
            } else if (operatorText === '**3') {
                result = Math.pow(value, 3);
            } else if (operatorText === 'factorial(') {
                result = factorial(value);
            } else {
                // For other unary functions, append them
                append(operatorText);
                return;
            }
            
            if (isNaN(result) || !isFinite(result)) {
                display.value = 'Error';
                currentExpression = '';
                historyDisplay.textContent = 'Ø®Ø·Ø£';
            } else {
                // To properly save to history, you might need to track the operation
                let oldExpression = currentExpression;
                currentExpression = String(result);
                history.push(`${oldExpression.trim()} ${operatorText.replace('**','^')} = ${result}`);
                saveHistory();
                display.value = result;
                historyDisplay.textContent = `${oldExpression.trim()} ${operatorText.replace('**','^')} = ${result}`; // Show last full operation
                updateHistoryList();
            }
        }


        // Factorial function
        function factorial(n) {
            if (n < 0 || !Number.isInteger(n)) {
                return NaN; // Or 'Error' for display
            }
            if (n === 0) return 1;
            let res = 1;
            for (let i = 1; i <= n; i++) {
                res *= i;
            }
            return res;
        }

        // Placeholder for y-th root function (more complex, requires two numbers)
        function root(x, y) {
            if (y === 0) return NaN; // Cannot take 0th root
            if (x < 0 && y % 2 === 0) return NaN; // Even root of negative number
            return Math.pow(x, 1 / y);
        }


        function calculate() {
            if (currentExpression === '') return;

            let expressionToEvaluate = currentExpression;

            // Step 1: Replace constants with their Math equivalents
            expressionToEvaluate = expressionToEvaluate.replace(/Math\.PI/g, Math.PI);
            expressionToEvaluate = expressionToEvaluate.replace(/Math\.E/g, Math.E);

            // Step 2: Handle factorial: replace x! with factorial(x)
            // This regex tries to capture numbers before a '!'
            expressionToEvaluate = expressionToEvaluate.replace(/(\d+\.?\d*)!/g, 'factorial($1)');

            // Step 3: Handle percentage: replace N% with (N / 100)
            expressionToEvaluate = expressionToEvaluate.replace(/(\d+\.?\d*)%/g, '($1 / 100)');


            // Step 4: Convert trigonometric function arguments from degrees to radians if needed
            if (!isRadians) {
                // This regex captures Math.sin(X), Math.cos(X), Math.tan(X) and transforms X
                // It's a simplistic approach; a full parser is more robust for nested functions.
                expressionToEvaluate = expressionToEvaluate.replace(/(Math\.(?:sin|cos|tan|asin|acos|atan))\(([^)]+)\)/g, (match, func, arg) => {
                    // Check if it's an inverse function which returns radians and should be converted back to degrees for display
                    if (func === 'Math.asin' || func === 'Math.acos' || func === 'Math.atan') {
                        // For inverse functions, the argument is already a ratio, result is radians.
                        // We want to return degrees, so apply (result * 180 / Math.PI)
                        return `(${func}(${arg}) * 180 / Math.PI)`;
                    } else {
                        // For direct trig functions (sin, cos, tan), the argument is in degrees
                        return `${func}((${arg}) * Math.PI / 180)`;
                    }
                });
            }
            
            // Step 5: Replace custom function names with Math. functions for eval
            expressionToEvaluate = expressionToEvaluate.replace(/ln\(/g, 'Math.log(');
            expressionToEvaluate = expressionToEvaluate.replace(/log\(/g, 'Math.log10(');
            expressionToEvaluate = expressionToEvaluate.replace(/log2\(/g, 'Math.log2(');
            expressionToEvaluate = expressionToEvaluate.replace(/exp\(/g, 'Math.exp('); // e^x
            expressionToEvaluate = expressionToEvaluate.replace(/10\*\*/g, 'Math.pow(10,'); // 10^x
            expressionToEvaluate = expressionToEvaluate.replace(/root\(([^,]+),([^)]+)\)/g, 'root($1,$2)'); // Handle root function if needed, but not directly using Math.pow(x,1/y)
            expressionToEvaluate = expressionToEvaluate.replace(/abs\(/g, 'Math.abs(');
            expressionToEvaluate = expressionToEvaluate.replace(/cbrt\(/g, 'Math.cbrt('); // cube root

            try {
                let result = eval(expressionToEvaluate);
                if (isNaN(result) || !isFinite(result)) {
                    throw new Error('Invalid calculation');
                }
                lastResult = result;
                const entry = `${currentExpression} = ${result}`;
                history.push(entry);
                saveHistory();
                display.value = result;
                currentExpression = String(result);
                historyDisplay.textContent = entry; // Show last full operation
                updateHistoryList();
            } catch (e) {
                display.value = 'Error';
                currentExpression = '';
                historyDisplay.textContent = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©';
                console.error("Calculation Error:", e); // For debugging
            }
        }

        function backspace() {
            if (display.value === 'Error') {
                display.value = '0';
                currentExpression = '';
                historyDisplay.textContent = '';
                return;
            }
            display.value = display.value.slice(0, -1);
            currentExpression = currentExpression.slice(0, -1);
            if (display.value === '') {
                display.value = '0';
                currentExpression = '';
            }
            historyDisplay.textContent = currentExpression;
        }

        function clearDisplay() {
            display.value = '0';
            currentExpression = '';
            historyDisplay.textContent = '';
        }

        function changeSign() {
            if (currentExpression === '' || display.value === '0' || display.value === 'Error') return;

            // Try to change the sign of the last number in the expression
            let match = currentExpression.match(/(-?\d+\.?\d*)$/); // Match last number
            if (match) {
                let lastNumStr = match[1];
                let lastNum = parseFloat(lastNumStr);
                let newNumStr = String(lastNum * -1);
                currentExpression = currentExpression.slice(0, -lastNumStr.length) + newNumStr;
                display.value = currentExpression;
            } else if (!isNaN(parseFloat(currentExpression))) { // If it's a single number
                currentExpression = String(parseFloat(currentExpression) * -1);
                display.value = currentExpression;
            }
            historyDisplay.textContent = currentExpression;
        }

        // --- Toggle Modes & Features ---

        // Function to update the theme icon
        function updateThemeIcon() {
            const icon = toggleThemeButton.querySelector('i');
            if (document.body.classList.contains('dark')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        toggleThemeButton.onclick = () => {
            document.body.classList.toggle('dark');
            updateThemeIcon(); // Update the icon after toggling the theme
        };

        document.getElementById('toggle-history').onclick = () => {
            const isVisible = historyContainerDiv.style.display !== 'none';
            historyContainerDiv.style.display = isVisible ? 'none' : 'block';
            ageCalculatorDiv.style.display = 'none'; // Close other sections
        };

        document.getElementById('toggle-age').onclick = () => {
            const isVisible = ageCalculatorDiv.style.display !== 'none';
            ageCalculatorDiv.style.display = isVisible ? 'none' : 'block';
            historyContainerDiv.style.display = 'none'; // Close other sections
        };

        // --- 2nd Mode Toggle ---
        function toggleSecondMode() {
            isSecondMode = !isSecondMode;
            const allButtons = calculatorButtons.querySelectorAll('button[data-function], button[data-constant], button[data-type="toggle-2nd"]');
            
            allButtons.forEach(button => {
                const funcType = button.dataset.function || button.dataset.constant;
                
                if (funcType && functionMap[funcType]) {
                    const funcData = functionMap[funcType];
                    const newText = isSecondMode ? funcData.text2 : funcData.text1;
                    const newFunction = isSecondMode ? funcData['2nd'] : funcData['1st'];

                    button.textContent = newText;
                    
                    // Update onclick for functions that change behavior significantly
                    if (funcType === 'x2') { // x^2 vs x^3
                        button.onclick = () => applyUnaryOperator(newFunction);
                    } else if (funcType === 'xy') { // x^y vs y-th root
                        button.onclick = () => {
                            if (isSecondMode) { // y-th root of x
                                // For y-th root, you'd typically need to input two numbers (base and root)
                                // Simplifying for this example: If you need a specific 'y' for 'y-th root',
                                // you'd need a more complex input sequence.
                                // For demo, let's make Ê¸âˆšx map to Math.cbrt (cube root) for simplicity in 2nd mode.
                                appendFunction('Math.cbrt(');
                            } else {
                                append('**'); // x^y
                            }
                        };
                    } else if (funcType === 'abs') { // |x| vs Â³âˆšx
                         button.onclick = () => appendFunction(newFunction);
                    }
                    // For others (sin, cos, tan, ln, log, exp), just update the function string
                    else {
                        button.onclick = () => appendFunction(newFunction);
                    }
                } else if (button.dataset.type === 'toggle-2nd') {
                    button.textContent = isSecondMode ? '1st' : '2nd';
                }
            });
        }


        // --- Rad/Deg Toggle ---
        function toggleRadDeg() {
            isRadians = !isRadians;
            const radDegButton = document.querySelector('button[data-type="toggle-raddeg"]');
            if (radDegButton) {
                radDegButton.textContent = isRadians ? 'Rad' : 'Deg';
            }
        }


        // --- Copy Result ---
        function copyResult() {
            let textToCopy = '';
            if (display.value !== '0' && display.value !== 'Error' && display.value !== '') {
                textToCopy = String(display.value);
            } else if (ageResultDiv.textContent.trim() !== '') {
                textToCopy = ageResultDiv.textContent;
            } else {
                alert('Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªÙŠØ¬Ø© Ù„Ù„Ù†Ø³Ø®');
                return;
            }

            navigator.clipboard.writeText(textToCopy)
                .then(() => alert('ØªÙ… Ù†Ø³Ø® Ø§Ù„Ù†ØªÙŠØ¬Ø©!'))
                .catch(() => alert('ÙØ´Ù„ Ø§Ù„Ù†Ø³Ø®! ØªØ£ÙƒØ¯ Ù…Ù† Ù…Ù†Ø­ Ø§Ù„Ø£Ø°ÙˆÙ†Ø§Øª.'));
        }

        // --- History Functions ---
        function saveHistory() {
            localStorage.setItem('calc_history', JSON.stringify(history));
        }

        function updateHistoryList() {
            historyList.innerHTML = '';
            // Display last 10 entries, reversed (most recent first)
            history.slice(-10).reverse().forEach(item => {
                const li = document.createElement('li');
                li.textContent = item;
                historyList.appendChild(li);
            });
        }

        function clearHistory() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ø£Ù†Ùƒ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ ÙƒÙ„ Ø§Ù„Ø³Ø¬Ù„ØŸ')) {
                history = [];
                saveHistory();
                updateHistoryList();
            }
        }

        // --- Age Calculator Functions ---
        const signs = [
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø¬Ø¯ÙŠ", symbol: "â™‘ï¸", from: [12, 22], to: [1, 19], traits: "Ø¹Ù…Ù„ÙŠØŒ Ø·Ù…ÙˆØ­ØŒ Ù…Ù†Ø¸Ù…" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø¯Ù„Ùˆ", symbol: "â™’ï¸", from: [1, 20], to: [2, 18], traits: "Ù…Ø³ØªÙ‚Ù„ØŒ Ù…Ø¨ØªÙƒØ±ØŒ Ø¥Ù†Ø³Ø§Ù†ÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø­ÙˆØª", symbol: "â™“ï¸", from: [2, 19], to: [3, 20], traits: "Ø¹Ø§Ø·ÙÙŠØŒ Ø­Ø³Ø§Ø³ØŒ Ø®ÙŠØ§Ù„ÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø­Ù…Ù„", symbol: "â™ˆï¸", from: [3, 21], to: [4, 19], traits: "Ø¬Ø±ÙŠØ¡ØŒ Ù‚ÙŠØ§Ø¯ÙŠØŒ Ù†Ø´ÙŠØ·" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø«ÙˆØ±", symbol: "â™‰ï¸", from: [4, 20], to: [5, 20], traits: "ØµØ¨ÙˆØ±ØŒ Ø¹Ù†ÙŠØ¯ØŒ Ù…Ø§Ø¯ÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø¬ÙˆØ²Ø§Ø¡", symbol: "â™Šï¸", from: [5, 21], to: [6, 20], traits: "Ø°ÙƒÙŠØŒ Ù…ØªÙ‚Ù„Ø¨ØŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø³Ø±Ø·Ø§Ù†", symbol: "â™‹ï¸", from: [6, 21], to: [7, 22], traits: "Ø¹Ø§Ø·ÙÙŠØŒ Ø­Ù†ÙˆÙ†ØŒ Ù…Ø²Ø§Ø¬ÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø£Ø³Ø¯", symbol: "â™Œï¸", from: [7, 23], to: [8, 22], traits: "ÙˆØ§Ø«Ù‚ØŒ ÙƒØ±ÙŠÙ…ØŒ Ù‚ÙŠØ§Ø¯ÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø¹Ø°Ø±Ø§Ø¡", symbol: "â™ï¸", from: [8, 23], to: [9, 22], traits: "Ù…Ù†Ø¸Ù…ØŒ Ù†Ø§Ù‚Ø¯ØŒ Ø®Ø¬ÙˆÙ„" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ù…ÙŠØ²Ø§Ù†", symbol: "â™ï¸", from: [9, 23], to: [10, 22], traits: "Ø¹Ø§Ø¯Ù„ØŒ Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØŒ Ù…ØªØ±Ø¯Ø¯" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ø¹Ù‚Ø±Ø¨", symbol: "â™ï¸", from: [10, 23], to: [11, 21], traits: "ØºØ§Ù…Ø¶ØŒ Ù‚ÙˆÙŠØŒ Ø¹Ø§Ø·ÙÙŠ" },
            { name: "Ø¨Ø±Ø¬ Ø§Ù„Ù‚ÙˆØ³", symbol: "â™ï¸", from: [11, 22], to: [12, 21], traits: "Ù…ØºØ§Ù…Ø±ØŒ ØµØ±ÙŠØ­ØŒ Ù…ØªÙØ§Ø¦Ù„" }
        ];

        function getZodiacSign(month, day) {
            for (const sign of signs) {
                // Adjust month to be 1-indexed for comparison
                const currentMonth = month; // getMonth() returns 0-11, so it's already 1-indexed after adding 1

                if (sign.from[0] > sign.to[0]) { // Crosses year boundary (e.g., Dec-Jan)
                    if ((currentMonth === sign.from[0] && day >= sign.from[1]) ||
                        (currentMonth === sign.to[0] && day <= sign.to[1])) {
                        return sign;
                    }
                } else { // Within the same year
                    if (currentMonth === sign.from[0] && day >= sign.from[1] &&
                        currentMonth === sign.to[0] && day <= sign.to[1]) {
                        return sign;
                    }
                    if (currentMonth === sign.from[0] && day >= sign.from[1] && currentMonth < sign.to[0]) {
                        return sign;
                    }
                    if (currentMonth === sign.to[0] && day <= sign.to[1] && currentMonth > sign.from[0]) {
                        return sign;
                    }
                }
            }
            return { name: "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ", symbol: "â“", traits: "-" }; // Default if not found
        }


        function calculateAgeAndZodiac() {
            const input = birthdateInput.value;
            if (!input) {
                alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø§Ø®ØªØ± ØªØ§Ø±ÙŠØ® Ù…ÙŠÙ„Ø§Ø¯ ØµØ§Ù„Ø­');
                return;
            }
            const birthDate = new Date(input);
            const now = new Date();

            if (birthDate > now) {
                alert('ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø£Ù† ÙŠÙƒÙˆÙ† ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„');
                return;
            }

            let years = now.getFullYear() - birthDate.getFullYear();
            let months = now.getMonth() - birthDate.getMonth();
            let days = now.getDate() - birthDate.getDate();

            if (days < 0) {
                months--;
                // Get the number of days in the previous month of the current date
                days += new Date(now.getFullYear(), now.getMonth(), 0).getDate();
            }
            if (months < 0) {
                years--;
                months += 12;
            }

            const zodiacMonth = birthDate.getMonth() + 1; // getMonth() is 0-indexed, so add 1
            const zodiacDay = birthDate.getDate();
            const zodiac = getZodiacSign(zodiacMonth, zodiacDay);

            ageResultDiv.textContent =
                `Ø§Ù„Ø¹Ù…Ø±: ${years} Ø³Ù†Ø©ØŒ ${months} Ø´Ù‡Ø±ØŒ ${days} ÙŠÙˆÙ…\n` +
                `Ø§Ù„Ø¨Ø±Ø¬: ${zodiac.symbol} ${zodiac.name}\n` +
                `Ø§Ù„ØµÙØ§Øª: ${zodiac.traits}`;
        }

        // --- Clock Function ---
        function updateClock() {
            const now = new Date();
            let hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();
            const ampm = hours >= 12 ? 'Ù…' : 'Øµ';
            hours = hours % 12;
            hours = hours ? hours : 12; // The hour '0' (midnight/noon) should be '12'

            const timeStr = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')} ${ampm}`;
            document.getElementById('clock').textContent = `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ø­Ø§Ù„ÙŠ: ${timeStr}`;
        }

        // --- Initialization ---
        document.addEventListener('DOMContentLoaded', () => {
            // Load history from localStorage
            const savedHistory = JSON.parse(localStorage.getItem('calc_history') || '[]');
            history.push(...savedHistory);
            updateHistoryList();

            // Set initial 2nd mode button text and functions (call once)
            toggleSecondMode(); // This will initialize all buttons to their 1st mode texts/functions

            // Set initial Rad/Deg button text
            const radDegButton = document.querySelector('button[data-type="toggle-raddeg"]');
            if (radDegButton) {
                radDegButton.textContent = isRadians ? 'Rad' : 'Deg';
            }

            // Set initial theme icon based on current theme
            updateThemeIcon();

            // Start clock
            setInterval(updateClock, 1000);
            updateClock(); // Call immediately to avoid initial delay
        });
    </script>
</body>
</html>